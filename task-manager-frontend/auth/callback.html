<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>auth</title>
</head>
<body>
<script>
    document.addEventListener('DOMContentLoaded', () => {

        const params = new URLSearchParams(window.location.search);
        const code = params.get('code');

        if (!code) {
            document.body.innerHTML = 'No auth code found in URL';
            return;
        }

        fetch('/api/auth/exchange', {
            method: 'POST',
            headers: { 'Content-Type': 'application/json' },
            credentials: 'include', // needed for HTTP-only cookie
            body: JSON.stringify({ code })
        })
            .then(res => {
                if (!res.ok) throw new Error('Exchange failed');
                return res.json();
            })
            .then(() => {
                window.location.href = '/';
            })
            .catch(err => {
                document.body.innerHTML = 'Auth error: ' + err.message;
            });
    });
</script>
</body>
</html>
